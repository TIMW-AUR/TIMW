pkgname=mold-git
pkgver=2.39.1
pkgrel=1
arch=(x86_64)
depends=(gcc-libs glibc libblake3 mimalloc tbb zlib zstd)
makedepends=(cmake git mold python)
provides=(mold)
conflicts=(mold)
source=(mold::git+https://github.com/rui314/mold)

pkgver() {
    cd mold
    git describe --long --tags | sed -E 's/^v//;s/([^-]*-g)/r\1/;s/-/./g'
}

build() {
  cmake \
  -S mold \
  -B _build \
  -D CMAKE_BUILD_TYPE=release \
  -D CMAKE_INSTALL_PREFIX=/usr \
  -D MOLD_LTO=ON \
  -D MOLD_USE_MOLD=ON
  cmake --build _build
}

package() {
  DESTDIR="${pkgdir}" cmake --install _build
}
